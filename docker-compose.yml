services:
  selenium:
    image: selenium/standalone-chrome:latest
    # Reduced shared memory to save memory
    shm_size: 512mb
    ports:
      - "4444:4444"
    environment:
      - SE_NODE_MAX_SESSIONS=1
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_SESSION_REQUEST_TIMEOUT=300
      - SE_NODE_SESSION_TIMEOUT=300
      # Minimal screen size to reduce memory usage
      - SE_SCREEN_WIDTH=1024
      - SE_SCREEN_HEIGHT=768
      # Memory optimization flags
      - SE_VNC_NO_PASSWORD=1
      - SE_NODE_GRID_URL=http://localhost:4444
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4444/wd/hub/status"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 30s

  app:
    build: .
    depends_on:
      selenium:
        condition: service_healthy
    environment:
      - NAUKRI_EMAIL=${NAUKRI_EMAIL}
      - NAUKRI_PASSWORD=${NAUKRI_PASSWORD}
      - NAUKRI_PROFILE_URL=${NAUKRI_PROFILE_URL}
      - GITHUB_RESUME_URL=${GITHUB_RESUME_URL}
    volumes:
      - ./logs:/app/logs
      - ./cookies.json:/app/cookies.json
